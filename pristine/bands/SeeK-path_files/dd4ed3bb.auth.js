"use strict";angular.module("materialsCloudApp").controller("AuthCtrl",["$scope","$state","authService","messageService","CONFIG",function($scope,$state,authService,messageService,CONFIG){$scope.signin_visible;$scope.signout_visible;if(!authService.isSignedIn()){$scope.signin_visible=true;$scope.signout_visible=false}else{$scope.signin_visible=false;$scope.signout_visible=true}$scope.accept=false;$scope.signin=function(){authService.signin($scope.loginForm.email,$scope.loginForm.password).then(function(data){messageService.updateMessage("Successfully Logged In!",CONFIG.MESSAGE_TYPE.SUCCESS);if($state.params["next"]!==undefined){$scope.signin_visible=true;window.location.href=$state.params["next"]}else{$state.go("main.home")}},function(response){messageService.updateMessage("Login Failed!",CONFIG.MESSAGE_TYPE.ERROR,response)})};$scope.signin_as_guest=function(){authService.signInAsGuest().then(function(data){var token=data.response;messageService.updateMessage("Successfully Logged In As Guest!",CONFIG.MESSAGE_TYPE.SUCCESS);$state.go("main.home")},function(response){messageService.updateMessage("Login Failed!",CONFIG.MESSAGE_TYPE.ERROR,response)})};$scope.signup=function(){$scope.error=false;if(!$scope.accept){messageService.updateMessage("Accept terms and condition!",CONFIG.MESSAGE_TYPE.ERROR);return}authService.signup($scope.signupForm.email,$scope.signupForm.password,$scope.signupForm.firstname,$scope.signupForm.lastname,$scope.signupForm.institute).then(function(data){messageService.updateMessage("Successfully Registered Account, Please Sign In!",CONFIG.MESSAGE_TYPE.SUCCESS);$scope.signin_visible=true},function(response){messageService.updateMessage("Account Registration Failed!",CONFIG.MESSAGE_TYPE.ERROR,response)})};$scope.signout=function(){authService.signout().then(function(){messageService.updateMessage("Successfully Logged Out!",CONFIG.MESSAGE_TYPE.SUCCESS);$scope.signin_visible=true;$state.go("main.signin")},function(){messageService.updateMessage("Error while Log Out!",CONFIG.MESSAGE_TYPE.ERROR,response)})};$scope.validationValidHandler=function(message){};$scope.validationInvalidHandler=function(message){messageService.updateMessage("Please check your input!",CONFIG.MESSAGE_TYPE.ERROR)};$scope.$on(CONFIG.EVENT_TYPE.AUTH.SIGNIN_SUCCESS,function(event,arg){$scope.signout_visible=true;$scope.signin_visible=false});$scope.$on(CONFIG.EVENT_TYPE.AUTH.SIGNOUT_SUCCESS,function(event,arg){$scope.signout_visible=false;$scope.signin_visible=true});$scope.$on(CONFIG.EVENT_TYPE.AUTH.TOKEN_EXPIRED,function(event,arg){$scope.signout_visible=false;$scope.signin_visible=true;messageService.updateMessage("No active session, Please login!",CONFIG.MESSAGE_TYPE.ERROR)})}]);