#!/bin/bash
#SBATCH -M arf
#SBATCH -p orfoz
#SBATCH -A amuhaymin
#SBATCH -J ecutrho
#SBATCH -N 4
#SBATCH --ntasks=448
#SBATCH --cpus-per-task=1
#SBATCH --time=01-01:00:00
#SBATCH --output=slurm-%j.out
#SBATCH --error=slurm-%j.err

export OMP_NUM_THREADS=1

echo "SLURM_NODELIST $SLURM_NODELIST"
echo "NUMBER OF CORES $SLURM_NTASKS"

module purge

source /arf/sw/comp/oneapi/2023.0/setvars.sh
module load oneapi-2023
module load lib/hdf5/1.14.3-oneapi-2023.0

module load apps/espresso/7.2-oneapi-2023.0

for k in 3; do

cat > k.$k.in << EOF
&CONTROL
  calculation = 'scf'
  outdir = './out/'
  prefix = 'ecutrho' 
  pseudo_dir = '/arf/home/amuhaymin/pseudo/' 
  verbosity = 'high'
  disk_io = 'none'
/
&SYSTEM
  ecutwfc = 150
  ecutrho = 600
  ibrav = 1
  a = 10.884420000
  nat = 64
  ntyp = 2
  occupations = 'smearing'
  smearing = 'gauss'
  degauss = 0.001
  nspin = 2
  starting_magnetization(1) = 0.000000000000000
  starting_magnetization(2) = 0.000000000000000
/
&ELECTRONS
  conv_thr =   1d-08
/
ATOMIC_SPECIES
S      32.065 S.pbe-n-kjpaw_psl.1.0.0.UPF
Zn     65.38 Zn.pbe-dnl-kjpaw_psl.1.0.0.UPF
ATOMIC_POSITIONS crystal
Zn           0.0000000000       0.0000000000       0.0000000000 
Zn           0.0000000000       0.2500000000       0.2500000000 
Zn           0.2500000000       0.0000000000       0.2500000000 
Zn           0.2500000000       0.2500000000       0.0000000000 
S            0.1250000000       0.3750000000       0.3750000000 
S            0.1250000000       0.1250000000       0.1250000000 
S            0.3750000000       0.3750000000       0.1250000000 
S            0.3750000000       0.1250000000       0.3750000000 
Zn           0.0000000000       0.0000000000       0.5000000000 
Zn           0.0000000000       0.2500000000       0.7500000000 
Zn           0.2500000000       0.0000000000       0.7500000000 
Zn           0.2500000000       0.2500000000       0.5000000000 
S            0.1250000000       0.3750000000       0.8750000000 
S            0.1250000000       0.1250000000       0.6250000000 
S            0.3750000000       0.3750000000       0.6250000000 
S            0.3750000000       0.1250000000       0.8750000000 
Zn           0.0000000000       0.5000000000       0.0000000000 
Zn           0.0000000000       0.7500000000       0.2500000000 
Zn           0.2500000000       0.5000000000       0.2500000000 
Zn           0.2500000000       0.7500000000       0.0000000000 
S            0.1250000000       0.8750000000       0.3750000000 
S            0.1250000000       0.6250000000       0.1250000000 
S            0.3750000000       0.8750000000       0.1250000000 
S            0.3750000000       0.6250000000       0.3750000000 
Zn           0.0000000000       0.5000000000       0.5000000000 
Zn           0.0000000000       0.7500000000       0.7500000000 
Zn           0.2500000000       0.5000000000       0.7500000000 
Zn           0.2500000000       0.7500000000       0.5000000000 
S            0.1250000000       0.8750000000       0.8750000000 
S            0.1250000000       0.6250000000       0.6250000000 
S            0.3750000000       0.8750000000       0.6250000000 
S            0.3750000000       0.6250000000       0.8750000000 
Zn           0.5000000000       0.0000000000       0.0000000000 
Zn           0.5000000000       0.2500000000       0.2500000000 
Zn           0.7500000000       0.0000000000       0.2500000000 
Zn           0.7500000000       0.2500000000       0.0000000000 
S            0.6250000000       0.3750000000       0.3750000000 
S            0.6250000000       0.1250000000       0.1250000000 
S            0.8750000000       0.3750000000       0.1250000000 
S            0.8750000000       0.1250000000       0.3750000000 
Zn           0.5000000000       0.0000000000       0.5000000000 
Zn           0.5000000000       0.2500000000       0.7500000000 
Zn           0.7500000000       0.0000000000       0.7500000000 
Zn           0.7500000000       0.2500000000       0.5000000000 
S            0.6250000000       0.3750000000       0.8750000000 
S            0.6250000000       0.1250000000       0.6250000000 
S            0.8750000000       0.3750000000       0.6250000000 
S            0.8750000000       0.1250000000       0.8750000000 
Zn           0.5000000000       0.5000000000       0.0000000000 
Zn           0.5000000000       0.7500000000       0.2500000000 
Zn           0.7500000000       0.5000000000       0.2500000000 
Zn           0.7500000000       0.7500000000       0.0000000000 
S            0.6250000000       0.8750000000       0.3750000000 
S            0.6250000000       0.6250000000       0.1250000000 
S            0.8750000000       0.8750000000       0.1250000000 
S            0.8750000000       0.6250000000       0.3750000000 
Zn           0.5000000000       0.5000000000       0.5000000000 
Zn           0.5000000000       0.7500000000       0.7500000000 
Zn           0.7500000000       0.5000000000       0.7500000000 
Zn           0.7500000000       0.7500000000       0.5000000000 
S            0.6250000000       0.8750000000       0.8750000000 
S            0.6250000000       0.6250000000       0.6250000000 
S            0.8750000000       0.8750000000       0.6250000000 
S            0.8750000000       0.6250000000       0.8750000000
K_POINTS automatic
$k $k $k 0 0 0
EOF

mpirun pw.x -npool 4 < k.$k.in > k.$k.out
done
