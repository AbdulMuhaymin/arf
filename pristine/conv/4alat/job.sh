#!/bin/bash
#SBATCH -M arf
#SBATCH -p orfoz
#SBATCH -A amuhaymin
#SBATCH -J kpts
#SBATCH -N 10
#SBATCH --ntasks=1120
#SBATCH --cpus-per-task=1
#SBATCH --time=0-01:00:00
#SBATCH --output=slurm-%j.out
#SBATCH --error=slurm-%j.err
#SBATCH --mail-type=ALL
#SBATCH --mail-user=abdulmuhaymin@alumni.bilkent.edu.tr

export OMP_NUM_THREADS=1


echo "SLURM_NODELIST $SLURM_NODELIST"
echo "NUMBER OF CORES $SLURM_NTASKS"

module purge

source /arf/sw/comp/oneapi/2023.0/setvars.sh
module load oneapi-2023
module load lib/hdf5/1.14.3-oneapi-2023.0

module load apps/espresso/7.2-oneapi-2023.0

for alat in $(seq 10.86 0.01 11.00); do

cat > ZnS.a.$alat.in << EOF
&CONTROL
  calculation = 'scf'
  outdir = './out/'
  prefix = 'ZnS' 
  pseudo_dir = '/arf/home/amuhaymin/pseudo/' 
  verbosity = 'high'
  disk_io = 'none'
/
&SYSTEM
  ecutwfc =   150
  ecutrho = 600
  ibrav = 1
  a = $alat
  nat = 64
  ntyp = 2
  occupations = 'fixed'
/
&ELECTRONS
  conv_thr =   1d-08
/
ATOMIC_SPECIES
S      32.065 S.pbe-n-kjpaw_psl.1.0.0.UPF
Zn     65.38 Zn.pbe-dnl-kjpaw_psl.1.0.0.UPF
ATOMIC_POSITIONS crystal
Zn           0.0000000000       0.0000000000       0.0000000000 
Zn           0.0000000000       0.2500007425       0.2500007425 
Zn           0.2500007425       0.0000000000       0.2500007425 
Zn           0.2500007425       0.2500007425       0.0000000000 
S            0.1250003248       0.3750010673       0.3750010673 
S            0.1250003248       0.1250003248       0.1250003248 
S            0.3750010673       0.3750010673       0.1250003248 
S            0.3750010673       0.1250003248       0.3750010673 
Zn           0.0000000000       0.0000000000       0.5000014850 
Zn           0.0000000000       0.2500007425       0.7500022274 
Zn           0.2500007425       0.0000000000       0.7500022274 
Zn           0.2500007425       0.2500007425       0.5000014850 
S            0.1250003248       0.3750010673       0.8750025523 
S            0.1250003248       0.1250003248       0.6250018098 
S            0.3750010673       0.3750010673       0.6250018098 
S            0.3750010673       0.1250003248       0.8750025523 
Zn           0.0000000000       0.5000014850       0.0000000000 
Zn           0.0000000000       0.7500022274       0.2500007425 
Zn           0.2500007425       0.5000014850       0.2500007425 
Zn           0.2500007425       0.7500022274       0.0000000000 
S            0.1250003248       0.8750025523       0.3750010673 
S            0.1250003248       0.6250018098       0.1250003248 
S            0.3750010673       0.8750025523       0.1250003248 
S            0.3750010673       0.6250018098       0.3750010673 
Zn           0.0000000000       0.5000014850       0.5000014850 
Zn           0.0000000000       0.7500022274       0.7500022274 
Zn           0.2500007425       0.5000014850       0.7500022274 
Zn           0.2500007425       0.7500022274       0.5000014850 
S            0.1250003248       0.8750025523       0.8750025523 
S            0.1250003248       0.6250018098       0.6250018098 
S            0.3750010673       0.8750025523       0.6250018098 
S            0.3750010673       0.6250018098       0.8750025523 
Zn           0.5000014850       0.0000000000       0.0000000000 
Zn           0.5000014850       0.2500007425       0.2500007425 
Zn           0.7500022274       0.0000000000       0.2500007425 
Zn           0.7500022274       0.2500007425       0.0000000000 
S            0.6250018098       0.3750010673       0.3750010673 
S            0.6250018098       0.1250003248       0.1250003248 
S            0.8750025523       0.3750010673       0.1250003248 
S            0.8750025523       0.1250003248       0.3750010673 
Zn           0.5000014850       0.0000000000       0.5000014850 
Zn           0.5000014850       0.2500007425       0.7500022274 
Zn           0.7500022274       0.0000000000       0.7500022274 
Zn           0.7500022274       0.2500007425       0.5000014850 
S            0.6250018098       0.3750010673       0.8750025523 
S            0.6250018098       0.1250003248       0.6250018098 
S            0.8750025523       0.3750010673       0.6250018098 
S            0.8750025523       0.1250003248       0.8750025523 
Zn           0.5000014850       0.5000014850       0.0000000000 
Zn           0.5000014850       0.7500022274       0.2500007425 
Zn           0.7500022274       0.5000014850       0.2500007425 
Zn           0.7500022274       0.7500022274       0.0000000000 
S            0.6250018098       0.8750025523       0.3750010673 
S            0.6250018098       0.6250018098       0.1250003248 
S            0.8750025523       0.8750025523       0.1250003248 
S            0.8750025523       0.6250018098       0.3750010673 
Zn           0.5000014850       0.5000014850       0.5000014850 
Zn           0.5000014850       0.7500022274       0.7500022274 
Zn           0.7500022274       0.5000014850       0.7500022274 
Zn           0.7500022274       0.7500022274       0.5000014850 
S            0.6250018098       0.8750025523       0.8750025523 
S            0.6250018098       0.6250018098       0.6250018098 
S            0.8750025523       0.8750025523       0.6250018098 
S            0.8750025523       0.6250018098       0.8750025523 
K_POINTS automatic
4 4 4 0 0 0
EOF

mpirun pw.x -npool 10 < ZnS.a.$alat.in > ZnS.a.$alat.out
done 
exit
